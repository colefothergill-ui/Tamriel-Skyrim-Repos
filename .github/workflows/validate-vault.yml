name: Validate Vault

on:
  push:
    branches: ["*"]
  pull_request:
    branches: ["*"]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Run custom scan
        run: |
          python scripts/custom_scan.py
      
      - name: Verify campaign state
        run: |
          if [ -f state/campaign_state.json ]; then
            echo "✓ campaign_state.json exists"
            cat state/campaign_state.json
            # Check if campaign_state is true
            if grep -q '"campaign_state": true' state/campaign_state.json; then
              echo "✓ campaign_state is true"
            else
              echo "✗ campaign_state is not set to true"
              exit 1
            fi
          else
            echo "✗ campaign_state.json not found"
            exit 1
          fi
